<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Trabajo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/visual.css">
  <link rel="stylesheet" href="/static/css/calendario.css">
  <link rel="stylesheet" href="/static/css/tarea-card.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tarea-modal.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='avatars/barra_lateral.png')}}">

</head>
<body>
  <div class="d-flex" id="wrapper">
    <!-- Sidebar visual admin/lÃ­der, pero con lÃ³gica trabajador -->
    <nav id="sidebar" class="sidebar bg-success text-white vh-100 p-3">
      <div class="sidebar-header mb-4 d-flex flex-column align-items-center">
        <span class="sidebar-logo-wrap">
          <img src="/static/avatars/barra_lateral.png" alt="Logo" class="sidebar-logo" />
        </span>
        <span class="sidebar-title fw-bold">Trabajador</span>
      </div>
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item mb-2">
          <a href="#" class="nav-link text-white active" id="btn-inicio">
            <i class="bi bi-house-door me-2"></i> <span>Inicio</span>
          </a>
        </li>
        <li class="nav-item mb-2">
          <a href="#" class="nav-link text-white" id="btn-mis-tareas">
            <i class="bi bi-list-check me-2"></i> <span>Mis Tareas</span>
          </a>
        </li>
        <li class="nav-item mb-2">
          <a href="#" class="nav-link text-white" id="btn-planificacion">
            <i class="bi bi-clipboard-check me-2"></i> <span>Proyectos</span>
          </a>
        </li>
        <li class="nav-item mb-2">
          <a href="#" class="nav-link text-white" id="btn-calendario">
            <i class="bi bi-calendar3 me-2"></i> <span>Calendario</span>
          </a>
        </li>
        <li class="nav-item mb-2">
          <a href="#" class="nav-link text-white" id="btn-estadisticas">
            <i class="bi bi-graph-up me-2"></i> <span>EstadÃ­sticas</span>
          </a>
        </li>
        <li class="mt-3">
          <hr class="dropdown-divider bg-white opacity-25">
        </li>
        <li class="nav-item mb-2">
          <a href="#" class="nav-link text-white" id="btn-ayuda">
            <i class="bi bi-question-circle me-2"></i> <span>Ayuda</span>
          </a>
        </li>
      </ul>
    </nav>
    <!-- Contenido principal -->
    <div class="main-content flex-grow-1 d-flex flex-column">
      <!-- Topbar visual admin/lÃ­der, pero con lÃ³gica trabajador -->
      <nav class="navbar navbar-light bg-white shadow-sm px-4 mb-3">
        <div class="d-flex align-items-center w-100 justify-content-end">
          <div class="dropdown me-3">
            <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button" id="dropdownNotificaciones" data-bs-toggle="dropdown" aria-expanded="false" title="Notificaciones">
              <i class="bi bi-bell me-1"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end p-2 shadow-sm" aria-labelledby="dropdownNotificaciones" style="min-width: 250px;">
              <li class="text-muted small">ðŸ”” No hay notificaciones nuevas</li>
            </ul>
          </div>
          <div class="dropdown">
            <button class="btn btn-light dropdown-toggle d-flex align-items-center gap-2 px-2 py-1" type="button" id="avatarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="/static/avatars/perfil_predeterminado.png" class="rounded-circle" width="32" height="32" alt="Avatar" />
              <span class="d-none d-md-inline small fw-semibold">Usuario</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="avatarDropdown">
              <li><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#perfilModal">ðŸ‘¤ Perfil</button></li>
              <li><hr class="dropdown-divider"></li>
              <li><a href="{{ url_for('login.login') }}" class="dropdown-item text-danger">ðŸ”’ Cerrar sesiÃ³n</a></li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- SecciÃ³n: Inicio -->
      <main id="seccion-inicio" class="p-4" style="display: block;">
        <div class="container">
          <h2 class="text-success fw-bold mb-4">Â¡Bienvenido!</h2>
          <p class="lead">AquÃ­ puedes gestionar tus tareas y proyectos asignados.</p>
          <div class="alert alert-success" role="alert">
            Usa el menÃº lateral para navegar por las diferentes secciones.
          </div>

          <div class="mt-5">
            <h5 class="fw-bold mb-3">Mis Tareas Actuales</h5>
            {% if tareas %}
              <ul class="list-group">
                {% for tarea in tareas %}
                  <li class="list-group-item">
                    <strong>{{ tarea['titulo'] }}</strong><br>
                    {{ tarea['descripcion'] }}<br>
                    <small>Fecha: {{ tarea['fecha_vencimiento'] }} â€“ Prioridad: {{ tarea['prioridad'] }}</small>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <ul class="list-group">
                <li class="list-group-item text-center text-muted">No tienes tareas asignadas.</li>
              </ul>
            {% endif %}
          </div>


          <!-- Tips o recordatorios -->
          <div class="alert alert-info mt-4" role="alert">
            <i class="bi bi-lightbulb me-2"></i>
            Consejo: Â¡No olvides revisar tus tareas y fechas de entrega cada dÃ­a!
          </div>
        </div>
      </main>

      <!-- Inyectar tareas reales para JS -->
      <script>
        window.tareasUsuario = {{ tareas|tojson }};
      </script>
      <!-- SecciÃ³n: Mis Tareas -->
      <main class="p-4" id="seccion-mis-tareas" style="display: none !important;">
        <div class="container">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-success fw-bold">Mis Tareas</h2>
            <div>
              <button class="btn btn-outline-secondary me-2" id="btn-exportar-tareas">
                <i class="bi bi-file-earmark-excel me-1"></i> Exportar
              </button>
              <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#tareaFilterModal">
                <i class="bi bi-funnel me-1"></i> Filtros
              </button>
            </div>
          </div>
          <!-- Resumen de estado -->
          <div class="row mb-4 justify-content-center" id="resumen-estado-tareas">
            <div class="col-6 col-md-3 mb-3">
              <div class="card border-0 shadow resumen-estado-card bg-white text-center h-100 animate__animated animate__fadeInUp">
                <div class="card-body py-4">
                  <div class="icon-circle bg-success bg-opacity-10 mb-2 mx-auto"><i class="bi bi-list-task text-success"></i></div>
                  <h6 class="card-title text-muted">Total Tareas</h6>
                  <h2 class="card-text fw-bold text-success mb-0" id="total-tareas-js">0</h2>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3 mb-3">
              <div class="card border-0 shadow resumen-estado-card bg-white text-center h-100 animate__animated animate__fadeInUp animate__delay-1s">
                <div class="card-body py-4">
                  <div class="icon-circle bg-primary bg-opacity-10 mb-2 mx-auto"><i class="bi bi-check-circle-fill text-primary"></i></div>
                  <h6 class="card-title text-muted">Completadas</h6>
                  <h2 class="card-text fw-bold text-primary mb-0" id="tareas-completadas-js">0</h2>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3 mb-3">
              <div class="card border-0 shadow resumen-estado-card bg-white text-center h-100 animate__animated animate__fadeInUp animate__delay-2s">
                <div class="card-body py-4">
                  <div class="icon-circle bg-warning bg-opacity-10 mb-2 mx-auto"><i class="bi bi-hourglass-split text-warning"></i></div>
                  <h6 class="card-title text-muted">En progreso</h6>
                  <h2 class="card-text fw-bold text-warning mb-0" id="tareas-progreso-js">0</h2>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3 mb-3">
              <div class="card border-0 shadow resumen-estado-card bg-white text-center h-100 animate__animated animate__fadeInUp animate__delay-3s">
                <div class="card-body py-4">
                  <div class="icon-circle bg-danger bg-opacity-10 mb-2 mx-auto"><i class="bi bi-exclamation-circle-fill text-danger"></i></div>
                  <h6 class="card-title text-muted">Atrasadas</h6>
                  <h2 class="card-text fw-bold text-danger mb-0" id="tareas-atrasadas-js">0</h2>
                </div>
              </div>
            </div>
          </div>
          <style>
            .resumen-estado-card {
              border-radius: 1.2rem;
              transition: box-shadow 0.2s, transform 0.2s;
            }
            .resumen-estado-card:hover {
              box-shadow: 0 8px 32px rgba(25,135,84,0.10);
              transform: translateY(-4px) scale(1.03);
            }
            .icon-circle {
              width: 54px;
              height: 54px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 2rem;
              margin-bottom: 0.5rem;
              box-shadow: 0 2px 8px rgba(25,135,84,0.08);
            }
          </style>
          <!-- Buscador de tareas -->
          <div class="mb-4">
            <div class="input-group">
              <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
              <input id="buscar-tarea" class="form-control" type="text" placeholder="Buscar tareas por tÃ­tulo o descripciÃ³n..." autocomplete="off">
            </div>
          </div>
          <!-- Tarjetas de tareas en modo tarjeta dentro de la secciÃ³n -->
          <div id="contenedorTarjetasTareas" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-4">
            {% if tareas %}
              {% for tarea in tareas %}
                <div class="col">
                  <div class="card h-100 shadow-sm border-0 tarea-card-custom position-relative tarea-borde-{{ tarea['estado']|replace(' ', '-')|lower }} animate__animated animate__fadeInUp tarea-interactiva" data-tarea-id="{{ tarea['id'] }}" style="cursor:pointer;">
                    <div class="card-body d-flex flex-column justify-content-between">
                      <div>
                        <h5 class="card-title fw-bold mb-2 tarea-titulo">{{ tarea['titulo'] }}</h5>
                        <p class="card-text text-muted mb-3 tarea-desc">{{ tarea['descripcion'] }}</p>
                      </div>
                      <ul class="list-group list-group-flush mb-3 tarea-lista">
                        <li class="list-group-item px-0 py-1 border-0 d-flex align-items-center">
                          <i class="bi bi-flag me-2 text-danger tarea-icon"></i>
                          <span class="fw-semibold">Prioridad:</span> <span class="ms-1">{{ tarea['prioridad']|capitalize }}</span>
                        </li>
                        <li class="list-group-item px-0 py-1 border-0 d-flex align-items-center">
                          <i class="bi bi-calendar-event me-2 text-primary tarea-icon"></i>
                          <span class="fw-semibold">Vence:</span> <span class="ms-1">{{ tarea['fecha_vencimiento'] }}</span>
                        </li>
                        <li class="list-group-item px-0 py-1 border-0 d-flex align-items-center">
                          <i class="bi bi-clipboard-check me-2 text-success tarea-icon"></i>
                          <span class="fw-semibold">Estado:</span> <span class="ms-1">{{ tarea['estado']|capitalize }}</span>
                        </li>
                        {% if tarea['ruta_archivo'] %}
                        <li class="list-group-item px-0 py-1 border-0 d-flex align-items-center">
                          <i class="bi bi-paperclip me-2 text-info tarea-icon"></i>
                          <span class="fw-semibold">Archivo:</span>
                          <a href="/static/archivos_tareas/{{ tarea['ruta_archivo'] }}" class="ms-2 link-success fw-semibold text-truncate tarea-archivo-link" target="_blank" style="max-width: 140px; display: inline-block; vertical-align: middle;">
                            <i class="bi bi-file-earmark-arrow-down me-1"></i>{{ tarea['ruta_archivo']|truncate(18, True, '...') }}
                          </a>
                        </li>
                        {% endif %}
                      </ul>
                      <div class="d-flex justify-content-between align-items-center mt-auto">
                        {% if tarea['ruta_archivo'] %}
                          <a href="/static/archivos_tareas/{{ tarea['ruta_archivo'] }}" class="btn btn-archivo-tarea" target="_blank"><i class="bi bi-paperclip me-1"></i> Archivo</a>
                        {% endif %}
                        <span class="badge estado-badge estado-badge-{{ tarea['estado']|replace(' ', '-')|lower }}">
                          <i class="bi {% if tarea['estado']=='completado' %}bi-check-circle-fill{% elif tarea['estado']=='en progreso' %}bi-hourglass-split{% elif tarea['estado']=='atrasada' %}bi-exclamation-circle-fill{% else %}bi-circle{% endif %} me-1"></i>
                          {{ tarea['estado']|capitalize }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <div class="col-12">
                <div class="alert alert-info text-center">No tienes tareas asignadas.</div>
              </div>
            {% endif %}
          </div>
          <style>
            .tarea-card-custom.tarea-interactiva {
              transition: box-shadow 0.32s cubic-bezier(.4,1.6,.4,1), transform 0.28s cubic-bezier(.4,1.6,.4,1);
              will-change: box-shadow, transform;
              box-shadow: 0 2px 8px rgba(25,135,84,0.08), 0 1.5px 4px rgba(25,135,84,0.06);
              border-radius: 1.1rem;
              background: linear-gradient(120deg, #f8fff8 80%, #e9f9ee 100%);
            }
            .tarea-card-custom.tarea-interactiva:hover, .tarea-card-custom.tarea-interactiva:focus-within {
              box-shadow: 0 16px 40px rgba(25,135,84,0.22), 0 4px 16px rgba(25,135,84,0.13);
              transform: translateY(-14px) scale(1.045) rotateZ(-0.5deg);
              z-index: 10;
              border: 1.5px solid #19875433;
              background: linear-gradient(120deg, #e9f9ee 70%, #d0f5e2 100%);
            }
            .tarea-card-custom.tarea-interactiva:active {
              transform: translateY(-2px) scale(1.01);
              box-shadow: 0 4px 12px rgba(25,135,84,0.13);
            }
          </style>
          <!-- Tabla de tareas -->
          <div class="card shadow-sm">
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0" id="tabla-mis-tareas">
                  <tbody>
                    <!-- Las tareas se cargarÃ¡n dinÃ¡micamente aquÃ­ desde el Javascript -->
                  </tbody>
                </table>
              </div>
              <!-- PaginaciÃ³n -->
              <nav aria-label="PaginaciÃ³n de tareas" class="p-3">
                <ul class="pagination justify-content-center mb-0" id="tareas-paginacion">
                  <!-- La paginaciÃ³n se generarÃ¡ dinÃ¡micamente -->
                </ul>
              </nav>
            </div>
          </div>
          <!-- Modal de Filtros -->
          <div class="modal fade" id="tareaFilterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="filterModalLabel">Filtrar Tareas</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3">
                    <label class="form-label">Estado</label>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="pendiente" id="filter-pendiente" checked>
                      <label class="form-check-label" for="filter-pendiente">Pendientes</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="en progreso" id="filter-progreso" checked>
                      <label class="form-check-label" for="filter-progreso">En progreso</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="completada" id="filter-completada" checked>
                      <label class="form-check-label" for="filter-completada">Completadas</label>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Prioridad</label>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="alta" id="filter-alta" checked>
                      <label class="form-check-label" for="filter-alta">Alta</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="media" id="filter-media" checked>
                      <label class="form-check-label" for="filter-media">Media</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="baja" id="filter-baja" checked>
                      <label class="form-check-label" for="filter-baja">Baja</label>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="filter-date-from" class="form-label">Fecha desde:</label>
                    <input type="date" class="form-control" id="filter-date-from">
                  </div>
                  <div class="mb-3">
                    <label for="filter-date-to" class="form-label">Fecha hasta:</label>
                    <input type="date" class="form-control" id="filter-date-to">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                  <button type="button" class="btn btn-primary" id="aplicar-filtros">Aplicar Filtros</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Fin secciÃ³n tarjetas -->
        </div>
      </main>

      <!-- SecciÃ³n: Calendario -->
      <main class="p-4" id="contenido-calendario" style="display: none;">
        <section class="calendar">
          <header class="calendar__header d-flex align-items-center justify-content-center mb-3">
            <button id="btn-prev" class="calendar__button"><i class="bi bi-chevron-left"></i></button>
            <h3 class="text-white mx-3 mb-0" id="calendar-date"></h3>
            <button id="btn-next" class="calendar__button"><i class="bi bi-chevron-right"></i></button>
          </header>
          <section class="calendar__weekdays">
            <div class="calendar__weekday">Lun</div>
            <div class="calendar__weekday">Mar</div>
            <div class="calendar__weekday">MiÃ©</div>
            <div class="calendar__weekday">Jue</div>
            <div class="calendar__weekday">Vie</div>
            <div class="calendar__weekday">SÃ¡b</div>
            <div class="calendar__weekday">Dom</div>
          </section>
          <ol class="calendar__days" id="calendar-days"></ol>
          <div id="tooltip-evento"></div>
        </section>
      </main>

      <!-- SecciÃ³n: Proyectos -->
      <main class="p-4" id="contenido-planificacion" style="display: none;">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Mis Proyectos Asignados</h5>
            <div class="table-responsive">
              <table class="table table-bordered table-striped">
                <thead class="table-success">
                  <tr>
                    <th>Nombre</th>
                    <th>DescripciÃ³n</th>
                    <th>Fecha inicio</th>
                    <th>Fecha fin</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="tabla-planificacion">
                  <!-- AquÃ­ se insertan los proyectos por JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>

      <!-- SecciÃ³n: EstadÃ­sticas -->
      <main class="p-4" id="seccion-estadisticas" style="display: none;">
        <div class="container">
          <h2 class="text-success fw-bold mb-4">Mis EstadÃ­sticas</h2>
          
          <!-- Resumen del rendimiento -->
          <div class="row mb-4">
            <div class="col-md-4 mb-3">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h5 class="card-title">Rendimiento Semanal</h5>
                  <div class="d-flex align-items-center mt-3">
                    <div class="progress flex-grow-1 me-3" style="height: 10px;">
                      <div id="progreso-semanal" class="progress-bar bg-success" style="width: 0%"></div>
                    </div>
                    <h4 id="porcentaje-semanal" class="mb-0">0%</h4>
                  </div>
                  <p class="card-text text-muted mt-3">Basado en tareas completadas vs asignadas</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h5 class="card-title">Tareas a Tiempo</h5>
                  <div class="d-flex align-items-center justify-content-center mt-3">
                    <div class="position-relative" style="width: 120px; height: 120px;">
                      <div class="position-absolute top-50 start-50 translate-middle text-center">
                        <h4 id="tasa-tiempo" class="mb-0">0%</h4>
                      </div>
                      <canvas id="grafico-tiempo" width="120" height="120"></canvas>
                    </div>
                  </div>
                  <p class="card-text text-muted text-center mt-3">Tareas completadas antes de la fecha lÃ­mite</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h5 class="card-title">Tareas del Mes</h5>
                  <div class="d-flex justify-content-around text-center mt-3">
                    <div>
                      <h2 id="tareas-mes-completadas" class="text-success mb-0">0</h2>
                      <small class="text-muted">Completadas</small>
                    </div>
                    <div>
                      <h2 id="tareas-mes-total" class="mb-0">0</h2>
                      <small class="text-muted">Total</small>
                    </div>
                  </div>
                  <p class="card-text text-muted text-center mt-3">Progreso del mes actual</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- GrÃ¡ficos de actividad -->
          <div class="row">
            <div class="col-lg-8 mb-4">
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title mb-4">Actividad por Semana</h5>
                  <canvas id="grafico-actividad-semanal" height="250"></canvas>
                </div>
              </div>
            </div>
            <div class="col-lg-4 mb-4">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h5 class="card-title mb-4">DistribuciÃ³n por Proyecto</h5>
                  <canvas id="grafico-proyectos" height="250"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Actividad reciente -->
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <h5 class="card-title">Actividad Reciente</h5>
              <ul class="list-group list-group-flush" id="lista-actividad">
                <!-- Se cargarÃ¡ dinÃ¡micamente -->
              </ul>
            </div>
          </div>
        </div>
      </main>

      <!-- SecciÃ³n: Ayuda -->
      <main class="p-4" id="seccion-ayuda" style="display: none;">
        <div class="container">
          <h2 class="text-success fw-bold mb-4">Centro de Ayuda</h2>
          
          <div class="row mb-4">
            <div class="col-md-7 mb-4">
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title mb-4">Preguntas Frecuentes</h5>
                  
                  <div class="accordion" id="accordionFAQ">
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          Â¿CÃ³mo puedo marcar una tarea como completada?
                        </button>
                      </h2>
                      <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionFAQ">
                        <div class="accordion-body">
                          Para marcar una tarea como completada, ve a la secciÃ³n <strong>"Mis Tareas"</strong> desde el menÃº lateral. Una vez allÃ­, busca la tarea que deseas completar y haz clic en el botÃ³n con el sÃ­mbolo de verificaciÃ³n (âœ“) que aparece en la columna "Acciones".
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                          Â¿CÃ³mo utilizo el calendario para ver mis tareas?
                        </button>
                      </h2>
                      <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFAQ">
                        <div class="accordion-body">
                          El calendario muestra todas tus tareas organizadas por fecha. Los dÃ­as que tienen tareas asignadas estÃ¡n marcados con un punto. Para ver el detalle de las tareas de un dÃ­a especÃ­fico, simplemente haz clic sobre ese dÃ­a en el calendario.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                          Â¿CÃ³mo adjunto archivos a una tarea?
                        </button>
                      </h2>
                      <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFAQ">
                        <div class="accordion-body">
                          Dentro de la secciÃ³n "Mis Tareas", al hacer clic en el botÃ³n "Ver detalles" de cualquier tarea, se abrirÃ¡ un modal con toda la informaciÃ³n de la tarea. En la parte inferior encontrarÃ¡s un botÃ³n para "Subir archivo" que te permitirÃ¡ adjuntar documentos a tu tarea.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-5 mb-4">
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title mb-4">Contactar Soporte</h5>
                  <form id="formulario-soporte">
                    <div class="mb-3">
                      <label for="asunto-soporte" class="form-label">Asunto</label>
                      <input type="text" class="form-control" id="asunto-soporte" placeholder="Ej: Problema con calendario">
                    </div>
                    <div class="mb-3">
                      <label for="tipo-soporte" class="form-label">Tipo de problema</label>
                      <select class="form-select" id="tipo-soporte">
                        <option selected value="">Selecciona una opciÃ³n</option>
                        <option value="tecnico">Problema tÃ©cnico</option>
                        <option value="acceso">Problema de acceso</option>
                        <option value="funcionalidad">Funcionalidad no disponible</option>
                        <option value="otro">Otro</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="descripcion-soporte" class="form-label">DescripciÃ³n</label>
                      <textarea class="form-control" id="descripcion-soporte" rows="4" placeholder="Describe tu problema detalladamente..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Enviar Consulta</button>
                  </form>
                </div>
              </div>
              
              <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                  <h5 class="card-title">GuÃ­as RÃ¡pidas</h5>
                  <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action">
                      <i class="bi bi-file-earmark-pdf me-2 text-danger"></i> GuÃ­a de usuario (PDF)
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                      <i class="bi bi-play-circle me-2 text-primary"></i> Video tutorial: GestiÃ³n de tareas
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                      <i class="bi bi-play-circle me-2 text-primary"></i> Video tutorial: Uso del calendario
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Modal Editar Perfil -->
      <div class="modal fade" id="perfilModal" tabindex="-1" aria-labelledby="perfilModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <form id="formPerfil" enctype="multipart/form-data">
              <div class="modal-header">
                <h5 class="modal-title" id="perfilModalLabel">Editar Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Nombre</label>
                  <input type="text" class="form-control" name="nombre" value="" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Acerca de mÃ­</label>
                  <textarea class="form-control" name="descripcion" rows="3"></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Avatar</label>
                  <input type="file" class="form-control" name="avatar" accept="image/*">
                </div>
                <div class="mb-3">
                  <label class="form-label">Avatar actual:</label><br>
                  <img src="/static/avatars/perfil_predeterminado.png" class="rounded-circle" width="100" height="100" alt="Avatar actual">
                </div>
                <div class="mb-3">
                  <label class="form-label">Vista previa:</label><br>
                  <img id="previewAvatar" class="rounded-circle border" width="100" height="100" alt="Vista previa">
                </div>
                <div id="mensajePerfil" class="mt-2 text-success fw-bold"></div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-success">Guardar cambios</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal Detalle de Tarea -->
      <div class="modal fade" id="modalDetalleTarea" tabindex="-1" aria-labelledby="modalDetalleTareaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header bg-success bg-opacity-10">
              <h5 class="modal-title fw-bold" id="modalDetalleTareaLabel">Detalle de la Tarea</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <div id="detalle-tarea-contenido">
                <!-- AquÃ­ se cargan los detalles dinÃ¡micamente -->
              </div>
              <hr>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Descargar archivo actual:</label>
                  <div id="detalle-tarea-archivo">
                    <!-- BotÃ³n de descarga dinÃ¡mico -->
                  </div>
                </div>
                <div class="col-md-6">
                  <form id="formSubirArchivoTarea" enctype="multipart/form-data">
                    <label class="form-label fw-semibold">Subir nuevo archivo:</label>
                    <div class="input-group">
                      <input type="file" class="form-control" name="archivo_tarea" id="inputArchivoTarea" accept="*/*">
                      <button class="btn btn-outline-success" type="submit"><i class="bi bi-upload"></i> Subir</button>
                    </div>
                    <div class="form-text">Formatos permitidos: PDF, DOCX, JPG, PNG, etc.</div>
                  </form>
                  <div id="mensajeArchivoTarea" class="mt-2"></div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-primary" id="btnEditarTareaModal"><i class="bi bi-pencil-square me-1"></i> Editar</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- BotÃ³n flotante de chat -->
      <button id="chatbox-toggle-btn" class="btn btn-success rounded-circle shadow-lg position-fixed" style="bottom: 32px; right: 32px; width: 56px; height: 56px; z-index: 1050; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
        <i class="bi bi-chat-dots"></i>
      </button>
      <!-- Chatbox flotante -->
      <div id="chatbox" class="chatbox shadow position-fixed" style="bottom: 32px; right: 32px; width: 350px; max-width: 95vw; display: none; z-index: 1060; border-radius: 1.1rem; overflow: hidden; background: #fff; box-shadow: 0 8px 32px rgba(25,135,84,0.18);">
        <div class="chatbox-header d-flex justify-content-between align-items-center px-3 py-2 bg-success bg-opacity-75 text-white">
          <span><i class="bi bi-chat-dots me-2"></i>Chat en lÃ­nea</span>
          <button id="chatbox-close-btn" class="btn btn-light btn-sm rounded-pill px-3 py-1 fw-semibold">Cerrar</button>
        </div>
        <div class="chatbox-body p-2" id="chat-mensaje" style="background: #f8fff8; min-height: 120px; max-height: 220px; overflow-y: auto;">
          <div class="text-muted text-center">Sin mensajes...</div>
        </div>
        <div class="chatbox-footer p-2 bg-white border-top">          <select id="chat-receptor" class="form-select mb-1">
            <option disabled selected>Seleccionar receptor</option>
            <option value="1">Supervisor</option>
            <option value="2">Administrador</option>
          </select>
          <textarea id="chat-input" class="form-control mb-1" rows="2" placeholder="Escribe mensaje..."></textarea>
          <button class="btn btn-success w-100" onclick="enviarMensaje()">Enviar</button>
        </div>
      </div>
      <style>
        #chatbox-toggle-btn {
          transition: box-shadow 0.2s, background 0.2s, transform 0.2s;
        }
        #chatbox-toggle-btn:hover {
          background: #157347;
          transform: scale(1.08);
        }
        #chatbox {
          animation: chatbox-fade-in 0.25s cubic-bezier(.4,1.6,.4,1);
        }
        @keyframes chatbox-fade-in {
          from { opacity: 0; transform: translateY(40px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
      </style>
      <script>
        // Mostrar/ocultar chatbox
        document.addEventListener('DOMContentLoaded', function() {
          const chatbox = document.getElementById('chatbox');
          const toggleBtn = document.getElementById('chatbox-toggle-btn');
          const closeBtn = document.getElementById('chatbox-close-btn');
          if (toggleBtn && chatbox) {
            toggleBtn.addEventListener('click', function() {
              chatbox.style.display = 'block';
              toggleBtn.style.display = 'none';
            });
          }
          if (closeBtn && chatbox) {
            closeBtn.addEventListener('click', function() {
              chatbox.style.display = 'none';
              toggleBtn.style.display = 'flex';
            });
          }
        });
      </script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script src="/static/js/dashboard.js"></script>
      <script src="/static/js/calendar.js"></script>
      <script src="/static/js/mostrar-calendario.js"></script>
      <script src="/static/js/tarea-modal.js"></script>
    </div>
  </div>
</body>
</html>
